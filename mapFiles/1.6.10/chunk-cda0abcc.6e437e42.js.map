{"version":3,"sources":["webpack:///./src/electron_browser/views/login/index.vue?4e0c","webpack:///./src/electron_browser/views/login/index.vue","webpack:///./src/electron_browser/util_function/cookies.ts","webpack:///./src/electron_browser/components/system/topbars/base.vue","webpack:///./src/electron_browser/components/system/topbars/base.vue?04ad","webpack:///./src/electron_browser/components/system/topbars/base.vue?6d73","webpack:///./src/electron_browser/views/login/index.vue?7103","webpack:///./src/electron_browser/views/login/index.vue?0842","webpack:///./src/electron_browser/components/system/topbars/base.vue?67d2"],"names":["id","class","src","name","mode","welcome","loginTexts","welcomeLogo","welcomeLogoKey","welcomeText","userData","account","disabled","logining","login","placeholder","type","password","disclaimerCheck","disclaimerDialog","keepLogined","loginDisabled","key","loginText","custom-class","title","footer","size","disclaimer","common","version","Cookies","value","ttl","localStorage","setItem","JSON","stringify","expiry","Date","getTime","parse","getItem","removeItem","error","minimize","close","HandlerMoving","components","methods","render","__scopeId","topbarBase","checkTimer","serveOnline","loginFailedText","computed","this","getCookie","autoLogin","then","res","$store","state","danmakuProfile","general","streamToolEnable","streamToolPath","checkOnline","clearInterval","setTimeout","sessionStorage","hasToken","validation","tokenInfo","userSession","setCookie","dispatch","$router","replace","get","serviceToken","set"],"mappings":"kHAAA,W,kKCCMA,GAAG,S,SAGDC,MAAM,S,GAELA,MAAM,Q,GACLA,MAAM,O,GAINA,MAAM,O,GAINA,MAAM,W,+BAE+E,S,+BAElE,S,+BAI8D,U,GAIjFA,MAAM,O,+BAC0E,O,GAGhFA,MAAM,e,SAORA,MAAM,W,GAELA,MAAM,e,+BAUR,O,EAGL,yBAAqD,OAAhDA,MAAM,SAASC,IAAI,4B,YACnBD,MAAM,c,0ZArDZ,yBAsDM,MAtDN,EAsDM,CArDL,yBAA8B,GAAjBA,MAAM,WACnB,yBAuCa,iBAvCDE,KAAK,OAAOC,KAAK,U,WAC5B,IAiCM,CAjCoB,EAAAC,S,yBAkC1B,yBAGM,MAHN,EAGM,CAFL,yBAAkF,OAA7EJ,MAAM,cAAeC,IAAG,GAAK,EAAAI,WAAWC,iBAAiB,EAAAC,kB,gBAC9D,yBAA2D,MAA3D,EAA2D,6BAA/B,EAAAF,WAAWG,aAAW,O,yBApCnD,yBAiCM,MAjCN,EAiCM,CAhCL,yBAA0B,GAAfR,MAAM,SACjB,yBA8BM,MA9BN,EA8BM,CA7BL,yBAGM,MAHN,EAGM,CAFL,yBAC4B,G,WADT,EAAAS,SAASC,Q,qCAAT,EAAAD,SAASC,QAAO,GAAGC,SAAU,EAAAC,SAAW,WAAQ,sBAAQ,EAAAC,MAAK,WAC/EC,YAAY,c,iDAEd,yBAGM,MAHN,EAGM,CAFL,yBAC8C,GADpCC,KAAK,W,WAAoB,EAAAN,SAASO,S,qCAAT,EAAAP,SAASO,SAAQ,GAAGL,SAAU,EAAAC,SAC/D,WAAQ,sBAAQ,EAAAC,MAAK,WAAEC,YAAY,Q,iDAEtC,yBAWM,MAXN,EAWM,CAVL,yBAKM,YAJL,yBAAwF,GAA3Ed,MAAM,W,WAAoB,EAAAS,SAASQ,gB,qCAAT,EAAAR,SAASQ,gBAAe,GAAGN,SAAU,EAAAC,U,oCACxE,yBAEQ,GAFGG,KAAK,OAAOf,MAAM,aAAc,QAAK,eAAE,EAAAkB,kBAAgB,GACpEP,SAAU,EAAAC,U,WAAU,IACtB,C,2BAED,yBAGM,YAFL,yBAAoF,GAAvEZ,MAAM,W,WAAoB,EAAAS,SAASU,Y,qCAAT,EAAAV,SAASU,YAAW,GAAGR,SAAU,EAAAC,U,wCAI1E,yBAGM,MAHN,EAGM,CAFL,yBACY,GADDG,KAAK,UAAWJ,SAAU,EAAAS,cAAepB,MAAM,SAAU,QAAK,eAAE,EAAAa,U,WAAS,IACpF,C,2BAED,yBAIM,MAJN,EAIM,CAHL,yBAEa,iBAFDX,KAAK,OAAOC,KAAK,U,WAC5B,IAA2C,E,yBAA3C,yBAA2C,OAArCkB,IAAK,EAAAC,WAAS,6BAAK,EAAAA,WAAS,M,qBAUvC,yBAAmC,GAAtBtB,MAAM,gBACnB,yBAQY,GARDuB,eAAa,aAAaC,MAAM,O,WAAgB,EAAAN,iB,qCAAA,EAAAA,iBAAgB,I,CAE/DO,OAAM,EAChB,IAGkB,CAHlB,yBAGkB,GAHPV,KAAK,UAAUW,KAAK,OAAQ,QAAK,gBAAU,WAAS,iBAAe,EAAgB,oBAAgB,K,WAG3G,IAAG,C,sBALP,IAAsC,CAAtC,yBAAsC,wCAA9B,EAAArB,WAAWsB,YAAU,K,uBAQ9B,EACA,yBAAsD,MAAtD,EAAwB,SAAM,6BAAE,EAAAC,OAAOC,SAAO,O,UCtDlC,MAAOC,EACpB,WAAWT,EAAaU,EAAYC,EAAM,QACzCC,aAAaC,QACZb,EACAc,KAAKC,UAAU,CACdL,QACAM,QAAQ,IAAIC,MAAOC,UAAYP,KAKlC,WAAWX,GACV,IACC,MAAM,OAAEgB,EAAF,MAAUN,GAAeI,KAAKK,MACnCP,aAAaQ,QAAQpB,IAAQ,IAE9B,OAAIgB,GAAS,IAAIC,MAAOC,UAAkBR,GAC1CE,aAAaS,WAAWrB,GACjB,MACN,MAAOsB,GACR,OAAO,O,yGCnBJ5C,GAAG,U,GACFC,MAAM,W,EAET,yBAAqC,QAA/BA,MAAM,wBAAsB,S,4IAHrC,yBAQM,MARN,EAQM,CAPL,yBAIM,MAJN,EAIM,CAHL,yBAEiB,Q,UADhB,IAAqC,CAArC,I,QAGF,yBAAwD,OAAnDA,MAAM,uBAAwB,QAAK,eAAE,EAAA4C,cAC1C,yBAAqD,OAAhD5C,MAAM,uBAAwB,QAAK,eAAE,EAAA6C,e,gBCL5C,MAAMC,EAAgB,kCAAqB,IAC1C,6CAEc,mCAAgB,CAC9B5C,KAAM,aACN6C,WAAY,CACXD,iBAEDE,QAAS,CACRJ,SAAA,cACAC,MAAA,c,UCRF,EAAOI,OAAS,EAChB,EAAOC,UAAY,kBAEJ,Q,gDCEA,+BAAgB,CAC9BhD,KAAM,QACN6C,WAAY,CACXI,WAAA,GAED,OACC,MAAMC,EAAkB,KACxB,MAAO,CACN3C,SAAU,CACTC,QAAS,GACTM,SAAU,GACVG,aAAa,EACbF,iBAAiB,GAElBW,OAAQ,iBACRV,kBAAkB,EAClBN,UAAU,EACVyC,aAAa,EACbD,aACAE,gBAAiB,GACjBlD,SAAS,EACTG,eAAgB,QAGlBgD,SAAU,CACTlD,WAAA,OACA,gBACC,OACEmD,KAAK/C,SAASC,UACd8C,KAAK/C,SAASO,WACdwC,KAAK/C,SAASQ,iBACfuC,KAAK5C,UAGP,YACC,OAAI4C,KAAK5C,SACD,SAEJ4C,KAAKF,gBACD,SAASE,KAAKF,gBAElBE,KAAKH,YACD,SAED,8BAGT,UACCG,KAAKC,YACLD,KAAKE,YACL,0BAAaC,KAAMC,IAAY,MAIM,GAHhCA,GACH,eAAOJ,KAAKK,OAAOC,MAAMC,eAAgBH,GAE1C,OAAIA,QAAJ,IAAIA,GAAJ,UAAIA,EAAKI,eAAT,OAAI,EAAcC,mBACjB,oBAAM,OAACL,QAAD,IAACA,GAAD,UAACA,EAAKI,eAAN,aAAC,EAAcE,kBAGvBV,KAAKW,eAEN,gBACCC,cAAcZ,KAAKJ,aAEpBJ,QAAS,CACR,cACC,iBAAWW,KAAKC,GAAQJ,KAAKH,YAAcO,GAC3CJ,KAAKJ,WAAaiB,WAAWb,KAAKW,YAAa,MAEhD,YAEEX,KAAKC,aACLD,KAAK/C,SAASU,aAC0B,UAAxCmD,eAAe7B,QAAQ,cAEvBe,KAAK3C,OAAM,IAGb,YAAY0D,GAAW,GAEtB,GADAf,KAAK5C,UAAW,GACX4C,KAAKgB,aAET,YADAhB,KAAK5C,UAAW,GAGjB,IAAI6D,EAAiBjB,KAAKK,OAAOC,MAAMY,YACvC,GAAIH,EACH,0BAAaE,QAEb,IACCA,QAAkB,mBAAMjB,KAAK/C,UAE5B,MAAOkC,GAIR,OAHAa,KAAK5C,UAAW,EAChB4C,KAAKpD,SAAU,OACfoD,KAAKF,gBAAkBX,GAIzBa,KAAKK,OAAOC,MAAMrD,SAAW+C,KAAK/C,SAClC+C,KAAKK,OAAOC,MAAMY,YAAcD,EAChCH,eAAepC,QAAQ,UAAW,QAClCoC,eAAepC,QAAQ,YAAa,SAChCsB,KAAK/C,SAASU,aACjBqC,KAAKmB,UAAUF,GAEhBjB,KAAKK,OAAOe,SAAS,SACrBpB,KAAKqB,QAAQC,QAAQ,cAEtB,YACC,MAAMrE,EAAWqB,EAAQiD,IAAI,YACvBN,EAAY3C,EAAQiD,IAAI,aAI9B,OAHItE,IACH+C,KAAK/C,SAAWA,KAEb,OAACgE,QAAD,IAACA,MAAWO,gBAGhBxB,KAAKK,OAAOC,MAAMY,YAAcD,GACzB,IAER,UAAUA,GACT,MAAMpC,EAAS,MACfP,EAAQmD,IAAI,WAAYzB,KAAK/C,SAAU4B,GACvCP,EAAQmD,IAAI,YAAaR,EAAWpC,IAErC,aACC,SACEmB,KAAK/C,SAASC,SACd8C,KAAK/C,SAASO,UACdwC,KAAK/C,SAASQ,qB,UCrInB,EAAOgC,OAASA,EAChB,EAAOC,UAAY,kBAEJ,gB,kCCRf,W","file":"js/chunk-cda0abcc.6e437e42.js","sourcesContent":["export * from \"-!../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=1769e366&lang=scss&scoped=true\"","<template>\r\n\t<div id=\"login\">\r\n\t\t<topbar-base class=\"topbar\" />\r\n\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t<div class=\"panel\" v-if=\"!welcome\">\r\n\t\t\t\t<hero-base class=\"hero\" />\r\n\t\t\t\t<div class=\"form\">\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<el-input v-model=\"userData.account\" :disabled=\"logining\" @keypress.enter=\"login\"\r\n\t\t\t\t\t\t\tplaceholder=\"A站账号手机号/邮箱\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<el-input type=\"password\" v-model=\"userData.password\" :disabled=\"logining\"\r\n\t\t\t\t\t\t\t@keypress.enter=\"login\" placeholder=\"A站密码\" />\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row sep\">\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<el-checkbox class=\"logCheck\" v-model=\"userData.disclaimerCheck\" :disabled=\"logining\" />\r\n\t\t\t\t\t\t\t同意 ><el-button type=\"text\" class=\"buttonText\" @click=\"disclaimerDialog = true\"\r\n\t\t\t\t\t\t\t\t:disabled=\"logining\">免责声明\r\n\t\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t<el-checkbox class=\"logCheck\" v-model=\"userData.keepLogined\" :disabled=\"logining\" />\r\n\t\t\t\t\t\t\t保持登录\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row\">\r\n\t\t\t\t\t\t<el-button type=\"primary\" :disabled=\"loginDisabled\" class=\"logBtn\" @click=\"login()\">登陆\r\n\t\t\t\t\t\t</el-button>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div class=\"row logText\">\r\n\t\t\t\t\t\t<transition name=\"fade\" mode=\"out-in\">\r\n\t\t\t\t\t\t\t<div :key=\"loginText\">{{ loginText }}</div>\r\n\t\t\t\t\t\t</transition>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div class=\"welcome\" v-else>\r\n\t\t\t\t<img class=\"welcomeLogo\" :src=\"`${loginTexts.welcomeLogo}?a=${welcomeLogoKey}`\" />\r\n\t\t\t\t<div class=\"welcomeText\">{{ loginTexts.welcomeText }}</div>\r\n\t\t\t</div>\r\n\t\t</transition>\r\n\t\t<footer-base class=\"foter right\" />\r\n\t\t<el-dialog custom-class=\"dialogBase\" title=\"免责声明\" v-model=\"disclaimerDialog\">\r\n\t\t\t<div>{{ loginTexts.disclaimer }}</div>\r\n\t\t\t<template #footer>\r\n\t\t\t\t<el-button type=\"primary\" size=\"mini\" @click=\"\r\n\t\t\t\t\t\tuserData.disclaimerCheck = true;\r\n\t\t\t\t\t\tdisclaimerDialog = false;\r\n\t\t\t\t\t\">我同意</el-button>\r\n\t\t\t</template>\r\n\t\t</el-dialog>\r\n\t\t<img class=\"acgirl\" src=\"/imgs/common/welcome.png\" />\r\n\t\t<div class=\"foter left\">软件版本号：{{common.version}}</div>\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent } from \"vue\";\r\nimport Cookies from \"@front/util_function/cookies\";\r\nimport topbarBase from \"@front/components/system/topbars/base.vue\";\r\nimport { loadConfig, launch } from \"@front/util_function/system\";\r\nimport { assign } from \"@front/util_function/base\";\r\nimport { login, loginSession } from \"@front/api/user\";\r\nimport { isOnline } from \"@front/api/utils/websocket\";\r\nimport { login as loginTexts, common } from \"@front/texts\";\r\n\r\nexport default defineComponent({\r\n\tname: \"login\",\r\n\tcomponents: {\r\n\t\ttopbarBase\r\n\t},\r\n\tdata() {\r\n\t\tconst checkTimer: any = null;\r\n\t\treturn {\r\n\t\t\tuserData: {\r\n\t\t\t\taccount: \"\",\r\n\t\t\t\tpassword: \"\",\r\n\t\t\t\tkeepLogined: false,\r\n\t\t\t\tdisclaimerCheck: false\r\n\t\t\t},\r\n\t\t\tcommon: common(),\r\n\t\t\tdisclaimerDialog: false,\r\n\t\t\tlogining: false,\r\n\t\t\tserveOnline: false,\r\n\t\t\tcheckTimer,\r\n\t\t\tloginFailedText: \"\",\r\n\t\t\twelcome: false,\r\n\t\t\twelcomeLogoKey: \"111\"\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tloginTexts,\r\n\t\tloginDisabled(): boolean {\r\n\t\t\treturn (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck ||\r\n\t\t\t\tthis.logining\r\n\t\t\t);\r\n\t\t},\r\n\t\tloginText(): string {\r\n\t\t\tif (this.logining) {\r\n\t\t\t\treturn \"登陆中...\";\r\n\t\t\t}\r\n\t\t\tif (this.loginFailedText) {\r\n\t\t\t\treturn `登陆失败： ${this.loginFailedText}`;\r\n\t\t\t}\r\n\t\t\tif (this.serveOnline) {\r\n\t\t\t\treturn \"服务端已连接\";\r\n\t\t\t}\r\n\t\t\treturn \"服务端离线,请尝试关闭工具箱并右键以管理员权限打开\";\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.getCookie();\r\n\t\tthis.autoLogin();\r\n\t\tloadConfig().then((res: any) => {\r\n\t\t\tif (res) {\r\n\t\t\t\tassign(this.$store.state.danmakuProfile, res);\r\n\t\t\t}\r\n\t\t\tif (res?.general?.streamToolEnable) {\r\n\t\t\t\tlaunch(res?.general?.streamToolPath);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.checkOnline();\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tclearInterval(this.checkTimer);\r\n\t},\r\n\tmethods: {\r\n\t\tcheckOnline() {\r\n\t\t\tisOnline().then(res => (this.serveOnline = res));\r\n\t\t\tthis.checkTimer = setTimeout(this.checkOnline, 5000);\r\n\t\t},\r\n\t\tautoLogin(): void {\r\n\t\t\tif (\r\n\t\t\t\tthis.getCookie() &&\r\n\t\t\t\tthis.userData.keepLogined &&\r\n\t\t\t\tsessionStorage.getItem(\"firstTime\") !== \"false\"\r\n\t\t\t) {\r\n\t\t\t\tthis.login(true);\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync login(hasToken = false) {\r\n\t\t\tthis.logining = true;\r\n\t\t\tif (!this.validation()) {\r\n\t\t\t\tthis.logining = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet tokenInfo: any = this.$store.state.userSession;\r\n\t\t\tif (hasToken) {\r\n\t\t\t\tloginSession(tokenInfo);\r\n\t\t\t} else {\r\n\t\t\t\ttry {\r\n\t\t\t\t\ttokenInfo = await login(this.userData);\r\n\t\t\t\t\t// console.log(tokenInfo);\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tthis.logining = false;\r\n\t\t\t\t\tthis.welcome = false;\r\n\t\t\t\t\tthis.loginFailedText = error;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.$store.state.userData = this.userData;\r\n\t\t\tthis.$store.state.userSession = tokenInfo;\r\n\t\t\tsessionStorage.setItem(\"logined\", \"true\");\r\n\t\t\tsessionStorage.setItem(\"firstTime\", \"false\");\r\n\t\t\tif (this.userData.keepLogined) {\r\n\t\t\t\tthis.setCookie(tokenInfo);\r\n\t\t\t}\r\n\t\t\tthis.$store.dispatch(\"login\");\r\n\t\t\tthis.$router.replace(\"dashboard\");\r\n\t\t},\r\n\t\tgetCookie() {\r\n\t\t\tconst userData = Cookies.get(\"userData\");\r\n\t\t\tconst tokenInfo = Cookies.get(\"tokenInfo\");\r\n\t\t\tif (userData) {\r\n\t\t\t\tthis.userData = userData;\r\n\t\t\t}\r\n\t\t\tif (!tokenInfo?.serviceToken) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tthis.$store.state.userSession = tokenInfo;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tsetCookie(tokenInfo: any) {\r\n\t\t\tconst expiry = 5 * 60 * 60 * 24 * 1000;\r\n\t\t\tCookies.set(\"userData\", this.userData, expiry);\r\n\t\t\tCookies.set(\"tokenInfo\", tokenInfo, expiry);\r\n\t\t},\r\n\t\tvalidation() {\r\n\t\t\tif (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck\r\n\t\t\t) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n</script>\r\n\r\n<style lang=\"scss\" scoped>\r\n@import \"@front/styles/variables.scss\";\r\n#login {\r\n\twidth: 100%;\r\n\theight: 100%;\r\n\tfont-size: $--font-size-base;\r\n\tcolor: rgba($color: white, $alpha: 0.9);\r\n\tbackground-color: $--color-primary;\r\n\tbox-shadow: $--box-shadow-dark;\r\n\tborder-radius: $--border-radius-small;\r\n\t.topbar {\r\n\t\tposition: absolute;\r\n\t\ttop: 0px;\r\n\t}\r\n\t.welcome {\r\n\t\tposition: absolute;\r\n\t\ttop: 50%;\r\n\t\tleft: 50%;\r\n\t\ttransform: translateX(-50%) translateY(-50%);\r\n\t\tuser-select: none;\r\n\t\ttext-align: center;\r\n\t\t.welcomeLogo {\r\n\t\t\twidth: 200px;\r\n\t\t\tmargin-top: -200px;\r\n\t\t\tpointer-events: none;\r\n\t\t}\r\n\t\t.welcomeText {\r\n\t\t\ttext-align: center;\r\n\t\t\tpadding: 24px 0px;\r\n\t\t\tfont-size: $--font-size-extra-large;\r\n\t\t}\r\n\t}\r\n\t.panel {\r\n\t\tposition: absolute;\r\n\t\ttop: 215px;\r\n\t\tleft: 120px;\r\n\t\tdisplay: flex;\r\n\t\tflex-direction: column;\r\n\t\talign-items: flex-start;\r\n\t\tz-index: 100;\r\n\t\t.hero {\r\n\t\t\tposition: fixed;\r\n\t\t\tleft: 425px;\r\n\t\t\ttop: 121px;\r\n\t\t\twidth: calc(100vw - 645px);\r\n\t\t}\r\n\t\t.form {\r\n\t\t\tpadding: 24px 0px;\r\n\t\t\theight: 300px;\r\n\t\t\twidth: 300px;\r\n\t\t\t.row {\r\n\t\t\t\tpadding: 6px 0px;\r\n\t\t\t\t.logBtn {\r\n\t\t\t\t\twidth: 300px;\r\n\t\t\t\t\theight: 42px;\r\n\t\t\t\t\tbackground-color: $--color-primary-light-3;\r\n\t\t\t\t\t&:hover {\r\n\t\t\t\t\t\tbackground-color: $--color-primary-light-5;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t&.sep {\r\n\t\t\t\t\tdisplay: flex !important;\r\n\t\t\t\t\tjustify-content: space-between;\r\n\t\t\t\t\talign-items: center;\r\n\t\t\t\t\tuser-select: none;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t&.logText {\r\n\t\t\t\tpadding: 16px 0px;\r\n\t\t\t\tuser-select: none;\r\n\t\t\t\twidth: 100%;\r\n\t\t\t\tword-break: break-all;\r\n\t\t\t}\r\n\r\n\t\t\t.buttonText {\r\n\t\t\t\tcolor: $--color-primary-light-3 !important;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n.foter {\r\n\tposition: absolute;\r\n\tbottom: 0px;\r\n\tfont-size: $--font-size-extra-small;\r\n\tcolor: rgba($color: white, $alpha: 0.5);\r\n\tpadding: 16px 0px;\r\n\t&.left {\r\n\t\tleft: 10px;\r\n\t\ttext-align: left;\r\n\t}\r\n\t&.right {\r\n\t\tright: 10px;\r\n\t\ttext-align: right;\r\n\t}\r\n}\r\n.acgirl {\r\n\tposition: absolute;\r\n\tright: 0px;\r\n\tbottom: 60px;\r\n}\r\n</style>\r\n","export default class Cookies {\r\n\tstatic set(key: string, value: any, ttl = 259200000): void {\r\n\t\tlocalStorage.setItem(\r\n\t\t\tkey,\r\n\t\t\tJSON.stringify({\r\n\t\t\t\tvalue,\r\n\t\t\t\texpiry: new Date().getTime() + ttl\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tstatic get(key: string): any | null {\r\n\t\ttry {\r\n\t\t\tconst { expiry, value }: any = JSON.parse(\r\n\t\t\t\tlocalStorage.getItem(key) || \"\"\r\n\t\t\t);\r\n\t\t\tif (expiry > new Date().getTime()) return value;\r\n\t\t\tlocalStorage.removeItem(key);\r\n\t\t\treturn null;\r\n\t\t} catch (error) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n}\r\n","<template>\r\n\t<div id=\"topbar\">\r\n\t\t<div class=\"handler\">\r\n\t\t\t<handler-moving>\r\n\t\t\t\t<span class=\"el-icon-more-outline\" />\r\n\t\t\t</handler-moving>\r\n\t\t</div>\r\n\t\t<div class=\"button el-icon-minus\" @click=\"minimize()\" />\r\n\t\t<div class=\"button el-icon-close\" @click=\"close()\" />\r\n\t</div>\r\n</template>\r\n\r\n<script lang=\"ts\">\r\nimport { defineComponent, defineAsyncComponent } from \"vue\";\r\nimport { minimize, close } from \"@front/util_function/system\";\r\nconst HandlerMoving = defineAsyncComponent(() =>\r\n\timport(\"@front/components/system/HandlerMoving.vue\")\r\n);\r\nexport default defineComponent({\r\n\tname: \"topbarBase\",\r\n\tcomponents: {\r\n\t\tHandlerMoving\r\n\t},\r\n\tmethods: {\r\n\t\tminimize,\r\n\t\tclose\r\n\t}\r\n});\r\n</script>\r\n\r\n<style scoped lang='scss'>\r\n#topbar {\r\n\twidth: 100%;\r\n\theight: 24px;\r\n\tdisplay: flex;\r\n\tposition: relative;\r\n\ttransition: background-color 0.25s;\r\n\tcursor: move;\r\n\t&:hover {\r\n\t\tbackground: rgba(0, 0, 0, 0.05);\r\n\t}\r\n\t.handler {\r\n\t\tposition: relative;\r\n\t\tflex-grow: 1;\r\n\t\tcolor: white;\r\n\t}\r\n\t.button {\r\n\t\tdisplay: flex;\r\n\t\talign-items: center;\r\n\t\tcursor: pointer;\r\n\t\tborder: none;\r\n\t\tbackground-color: rgba(0, 0, 0, 0);\r\n\t\tfont-size: 14px;\r\n\t\tcolor: white;\r\n\t\tborder-radius: 0px;\r\n\t\tpadding: 2px 8px;\r\n\t\tmargin: 0px;\r\n\t\ttransition: background-color 0.25s;\r\n\t\t&:hover {\r\n\t\t\tbackground-color: rgba(0, 0, 0, 0.25);\r\n\t\t}\r\n\t}\r\n}\r\n</style>\r\n","\r\nimport { defineComponent, defineAsyncComponent } from \"vue\";\r\nimport { minimize, close } from \"@front/util_function/system\";\r\nconst HandlerMoving = defineAsyncComponent(() =>\r\n\timport(\"@front/components/system/HandlerMoving.vue\")\r\n);\r\nexport default defineComponent({\r\n\tname: \"topbarBase\",\r\n\tcomponents: {\r\n\t\tHandlerMoving\r\n\t},\r\n\tmethods: {\r\n\t\tminimize,\r\n\t\tclose\r\n\t}\r\n});\r\n","import { render } from \"./base.vue?vue&type=template&id=5f1e490e&scoped=true\"\nimport script from \"./base.vue?vue&type=script&lang=ts\"\nexport * from \"./base.vue?vue&type=script&lang=ts\"\n\nimport \"./base.vue?vue&type=style&index=0&id=5f1e490e&scoped=true&lang=scss\"\nscript.render = render\nscript.__scopeId = \"data-v-5f1e490e\"\n\nexport default script","\r\nimport { defineComponent } from \"vue\";\r\nimport Cookies from \"@front/util_function/cookies\";\r\nimport topbarBase from \"@front/components/system/topbars/base.vue\";\r\nimport { loadConfig, launch } from \"@front/util_function/system\";\r\nimport { assign } from \"@front/util_function/base\";\r\nimport { login, loginSession } from \"@front/api/user\";\r\nimport { isOnline } from \"@front/api/utils/websocket\";\r\nimport { login as loginTexts, common } from \"@front/texts\";\r\n\r\nexport default defineComponent({\r\n\tname: \"login\",\r\n\tcomponents: {\r\n\t\ttopbarBase\r\n\t},\r\n\tdata() {\r\n\t\tconst checkTimer: any = null;\r\n\t\treturn {\r\n\t\t\tuserData: {\r\n\t\t\t\taccount: \"\",\r\n\t\t\t\tpassword: \"\",\r\n\t\t\t\tkeepLogined: false,\r\n\t\t\t\tdisclaimerCheck: false\r\n\t\t\t},\r\n\t\t\tcommon: common(),\r\n\t\t\tdisclaimerDialog: false,\r\n\t\t\tlogining: false,\r\n\t\t\tserveOnline: false,\r\n\t\t\tcheckTimer,\r\n\t\t\tloginFailedText: \"\",\r\n\t\t\twelcome: false,\r\n\t\t\twelcomeLogoKey: \"111\"\r\n\t\t};\r\n\t},\r\n\tcomputed: {\r\n\t\tloginTexts,\r\n\t\tloginDisabled(): boolean {\r\n\t\t\treturn (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck ||\r\n\t\t\t\tthis.logining\r\n\t\t\t);\r\n\t\t},\r\n\t\tloginText(): string {\r\n\t\t\tif (this.logining) {\r\n\t\t\t\treturn \"登陆中...\";\r\n\t\t\t}\r\n\t\t\tif (this.loginFailedText) {\r\n\t\t\t\treturn `登陆失败： ${this.loginFailedText}`;\r\n\t\t\t}\r\n\t\t\tif (this.serveOnline) {\r\n\t\t\t\treturn \"服务端已连接\";\r\n\t\t\t}\r\n\t\t\treturn \"服务端离线,请尝试关闭工具箱并右键以管理员权限打开\";\r\n\t\t}\r\n\t},\r\n\tmounted() {\r\n\t\tthis.getCookie();\r\n\t\tthis.autoLogin();\r\n\t\tloadConfig().then((res: any) => {\r\n\t\t\tif (res) {\r\n\t\t\t\tassign(this.$store.state.danmakuProfile, res);\r\n\t\t\t}\r\n\t\t\tif (res?.general?.streamToolEnable) {\r\n\t\t\t\tlaunch(res?.general?.streamToolPath);\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.checkOnline();\r\n\t},\r\n\tbeforeUnmount() {\r\n\t\tclearInterval(this.checkTimer);\r\n\t},\r\n\tmethods: {\r\n\t\tcheckOnline() {\r\n\t\t\tisOnline().then(res => (this.serveOnline = res));\r\n\t\t\tthis.checkTimer = setTimeout(this.checkOnline, 5000);\r\n\t\t},\r\n\t\tautoLogin(): void {\r\n\t\t\tif (\r\n\t\t\t\tthis.getCookie() &&\r\n\t\t\t\tthis.userData.keepLogined &&\r\n\t\t\t\tsessionStorage.getItem(\"firstTime\") !== \"false\"\r\n\t\t\t) {\r\n\t\t\t\tthis.login(true);\r\n\t\t\t}\r\n\t\t},\r\n\t\tasync login(hasToken = false) {\r\n\t\t\tthis.logining = true;\r\n\t\t\tif (!this.validation()) {\r\n\t\t\t\tthis.logining = false;\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\tlet tokenInfo: any = this.$store.state.userSession;\r\n\t\t\tif (hasToken) {\r\n\t\t\t\tloginSession(tokenInfo);\r\n\t\t\t} else {\r\n\t\t\t\ttry {\r\n\t\t\t\t\ttokenInfo = await login(this.userData);\r\n\t\t\t\t\t// console.log(tokenInfo);\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\tthis.logining = false;\r\n\t\t\t\t\tthis.welcome = false;\r\n\t\t\t\t\tthis.loginFailedText = error;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.$store.state.userData = this.userData;\r\n\t\t\tthis.$store.state.userSession = tokenInfo;\r\n\t\t\tsessionStorage.setItem(\"logined\", \"true\");\r\n\t\t\tsessionStorage.setItem(\"firstTime\", \"false\");\r\n\t\t\tif (this.userData.keepLogined) {\r\n\t\t\t\tthis.setCookie(tokenInfo);\r\n\t\t\t}\r\n\t\t\tthis.$store.dispatch(\"login\");\r\n\t\t\tthis.$router.replace(\"dashboard\");\r\n\t\t},\r\n\t\tgetCookie() {\r\n\t\t\tconst userData = Cookies.get(\"userData\");\r\n\t\t\tconst tokenInfo = Cookies.get(\"tokenInfo\");\r\n\t\t\tif (userData) {\r\n\t\t\t\tthis.userData = userData;\r\n\t\t\t}\r\n\t\t\tif (!tokenInfo?.serviceToken) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tthis.$store.state.userSession = tokenInfo;\r\n\t\t\treturn true;\r\n\t\t},\r\n\t\tsetCookie(tokenInfo: any) {\r\n\t\t\tconst expiry = 5 * 60 * 60 * 24 * 1000;\r\n\t\t\tCookies.set(\"userData\", this.userData, expiry);\r\n\t\t\tCookies.set(\"tokenInfo\", tokenInfo, expiry);\r\n\t\t},\r\n\t\tvalidation() {\r\n\t\t\tif (\r\n\t\t\t\t!this.userData.account ||\r\n\t\t\t\t!this.userData.password ||\r\n\t\t\t\t!this.userData.disclaimerCheck\r\n\t\t\t) {\r\n\t\t\t\treturn false;\r\n\t\t\t} else {\r\n\t\t\t\treturn true;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n});\r\n","import { render } from \"./index.vue?vue&type=template&id=1769e366&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=ts\"\nexport * from \"./index.vue?vue&type=script&lang=ts\"\n\nimport \"./index.vue?vue&type=style&index=0&id=1769e366&lang=scss&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-1769e366\"\n\nexport default script","export * from \"-!../../../../../node_modules/@vue/cli-service/node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!../../../../../node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!../../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../../node_modules/postcss-loader/src/index.js??ref--8-oneOf-1-2!../../../../../node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-3!../../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./base.vue?vue&type=style&index=0&id=5f1e490e&scoped=true&lang=scss\""],"sourceRoot":""}